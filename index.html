<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Usuários - CRUD</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 900px;
      margin: 40px auto;
      padding: 20px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
      color: #333;
    }
    .cards {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
    }
    .card {
      background: #fafafa;
      border-radius: 10px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.08);
      width: 220px;
      padding: 20px;
      text-align: center;
      position: relative;
    }
    .profile-img {
      width: 90px;
      height: 90px;
      object-fit: cover;
      border-radius: 50%;
      border: 3px solid #4a90e2;
      margin-bottom: 12px;
    }
    .card h2 {
      font-size: 1.2em;
      margin: 8px 0 4px;
    }
    .card p {
      margin: 2px 0;
      color: #555;
    }
    .actions {
      margin-top: 10px;
    }
    .actions button {
      margin: 0 3px;
      padding: 5px 10px;
      border-radius: 5px;
      border: none;
      cursor: pointer;
    }
    .edit-btn { background-color: #ffd700; }
    .delete-btn { background-color: #ff4d4d; color: #fff; }
    .add-form, .edit-form {
      margin-bottom: 30px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }
    .add-form input, .edit-form input {
      padding: 6px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    .add-form button, .edit-form button {
      background-color: #4a90e2; color: #fff; border: none; padding: 7px 15px; border-radius: 5px; cursor: pointer;
    }
    .edit-form {
      background-color: #f9f9f9; padding: 10px; border-radius: 8px; margin-top: 10px; display:none;
    }
    .show { display:flex !important; }
  </style>
</head>
<body>
<div class="container">
  <h1>Usuários</h1>
  
  <form class="add-form" id="addUserForm">
    <input type="text" id="nome" placeholder="Nome" required>
    <input type="email" id="email" placeholder="Email" required>
    <input type="date" id="data_nasc" required>
    <input type="text" id="cpf" placeholder="CPF" required maxlength="11">
    <input type="url" id="foto_url" placeholder="URL da Foto">
    <button type="submit">Adicionar Usuário</button>
  </form>

  <div class="cards" id="usersList"></div>
</div>

<!-- Edit form (modal style) -->
<div class="container" style="display:none;" id="editContainer">
  <form class="edit-form" id="editUserForm">
    <input type="hidden" id="edit_id">
    <input type="text" id="edit_nome" placeholder="Nome" required>
    <input type="email" id="edit_email" placeholder="Email" required>
    <input type="date" id="edit_data_nasc" required>
    <input type="text" id="edit_cpf" placeholder="CPF" required maxlength="11">
    <input type="url" id="edit_foto_url" placeholder="URL da Foto">
    <button type="submit">Salvar Alterações</button>
    <button type="button" onclick="closeEditForm()">Cancelar</button>
  </form>
</div>

<script>
const API_URL = 'http://localhost:3000/usuarios';

function renderUsers(users) {
  const usersList = document.getElementById('usersList');
  usersList.innerHTML = '';
  
  users.forEach(user => {
    const card = document.createElement('div');
    card.className = 'card';
    
    card.innerHTML = `
      <img src="${user.foto_url || 'https://via.placeholder.com/90?text=Foto'}" class="profile-img">
      <h2>${user.nome}</h2>
      <p><strong>Email:</strong> ${user.email}</p>
      <p><strong>Nascimento:</strong> ${user.data_nasc ? new Date(user.data_nasc).toLocaleDateString() : ''}</p>
      <div class="actions">
        <button class="edit-btn" onclick='openEditForm(${JSON.stringify(user)})'>Editar</button>
        <button class="delete-btn" onclick='deleteUser(${user.id})'>Excluir</button>
      </div>
    `;
    
    usersList.appendChild(card);
  });
}

async function fetchUsers() {
  const res = await fetch(API_URL);
  const users = await res.json();
  renderUsers(users);
}

document.getElementById('addUserForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  
  const user = {
    nome: document.getElementById('nome').value,
    email: document.getElementById('email').value,
    data_nasc: document.getElementById('data_nasc').value,
    cpf: document.getElementById('cpf').value,
    foto_url: document.getElementById('foto_url').value
  };
  
  await fetch(API_URL, {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify(user)
  });
  
  this.reset();
  fetchUsers();
});

window.deleteUser = async function(id) {
  if (confirm('Tem certeza que deseja excluir este usuário?')) {
    await fetch(`${API_URL}/${id}`, { method:'DELETE' });
    fetchUsers();
  }
};

window.openEditForm = function(user) {
  document.getElementById('editContainer').style.display = 'block';
  
  document.getElementById('edit_id').value = user.id;
  document.getElementById('edit_nome').value = user.nome;
  document.getElementById('edit_email').value = user.email;
  document.getElementById('edit_data_nasc').value = user.data_nasc ? user.data_nasc.split('T')[0] : '';
  document.getElementById('edit_cpf').value = user.cpf || '';
  document.getElementById('edit_foto_url').value = user.foto_url || '';
};

window.closeEditForm = function() {
  document.getElementById('editContainer').style.display = 'none';
};

document.getElementById('editUserForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  
  const id = document.getElementById('edit_id').value;

  const user = {
    nome: document.getElementById('edit_nome').value,
    email: document.getElementById('edit_email').value,
    data_nasc: document.getElementById('edit_data_nasc').value,
    cpf: document.getElementById('edit_cpf').value,
    foto_url: document.getElementById('edit_foto_url').value
  };
  
  await fetch(`${API_URL}/${id}`, {
    method:'PUT',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify(user)
  });
  
  closeEditForm();
  fetchUsers();
});

fetchUsers();
</script>
</body>
</html>